<TDocStdTable id="docs_exc_PageContainer" style="width:100%;height:100%;">
    <div id="docs_exc_ListContainer" style="width:310px;height:100%; margin:0;padding:0;"></div>
    <div id="docs_exc_DetailContainer" style="width:100%;height:100%; margin:0;padding:0;">
        <div id="docs_exc_DetailHeader" style="width:100%;height:auto; margin:0;padding:0;"></div>
        <div id="docs_exc_ProductsTable" style="width:100%;height:100%; margin:0;padding:0;"></div>
        <div id="docs_exc_DetailTotal" style="width:100%;height:auto;; margin:0;padding:0;"></div>
    </div>
    <div id="docs_exc_RightContainer" style="width:250px;height:100%; margin:0;padding:0;"></div>
</TDocStdTable>
<script type="text/javascript">

//    require(["app/app","app/tDocStdTable","dojo/request/iframe", /*"dojox/form/FileInput ",*/ "dojo/request/handlers", "app/request"],
//            function (APP, TDocStdTable, iframe/*,FileInput*/,handlers, Request) {
//    });
    $$.docs_exc_PageContainer
            .init({idListContainer:"docs_exc_ListContainer",idDetailContainer:"docs_exc_DetailContainer",
                idDetailHeader:"docs_exc_DetailHeader",idDetailTable:"docs_exc_ProductsTable",idDetailTotal:"docs_exc_DetailTotal",
                idRightContainer:"docs_exc_RightContainer" })
            .addListTable({getDataUrl:"/docs/exc/getDataForExcsListTable",
                header:"Список накладных", bdatelabelText:"c",bdateCondition:"DOCDATE>=", edatelabelText:"по",edateCondition:"DOCDATE<="
            })
            .setDetailHeaderParameters({dataIDName:"ChID",
                getDataUrl:"/docs/exc/getExcData", getDataForNewUrl:"/docs/exc/getNewExcData",
                postDataUrl:"/docs/exc/storeExcData", postForDeleteDataUrl:"/docs/exc/deleteExcData",
                dataStateName:"StateCode", activeStateValue:0
            })
            .addDetailHeaderTitle({title:"Перемещение товара",
                titleForNew:"Новая накладная перемещения", titleForNothing:"Перемещение товара не выбрано", titleForFailedLoad:"Нет данных",
                numberDataItemName:"DocID", dateDataItemName:"DocDate", titleDatePrefix:"от"},25)
            .addDetailHeaderRow(25,true)
            .addDetailHeaderSelect("OurName","Фирма", 330,{inputStyle:"width:200px", loadDropDownURL:"/dirsDocs/getDirOursForSelect", labelDataItem:"OurName"})
            .addDetailHeaderTextBox("DocID", "Номер", 120, {inputStyle:"width:50px"})
            .addDetailHeaderTextBox("IntDocID", "Вн. номер", 120, {inputStyle:"width:50px"})
            .addDetailHeaderDateTextBox("DocDate", "Дата", 150, "width:80px")
            .addDetailHeaderRow(25,true)
            .addDetailHeaderSelect("StockName","Со склада", 250,
                {inputStyle:"width:200px", loadDropDownURL:"/dirsDocs/getDirStocksForSelect", labelDataItem:"StockName"})
            .addDetailHeaderSelect("NewStockName","На склад", 280,
                {inputStyle:"width:200px", loadDropDownURL:"/dirsDocs/getDirStocksForSelect", labelDataItem:"StockName"})
            .addDetailHeaderSelect("CurrName","Валюта", 260,
                {inputStyle:"width:200px", loadDropDownURL:"/dirsDocs/getDirCurrsForSelect", labelDataItem:"CurrName"})
            .setDetailTableParameters({conditionIDName:"ParentChID",
                getDataUrl:"/docs/exc/getDataForExcDTable",
                storeDataUrl:"/docs/exc/storeExcDTableData", deleteDataUrl:"/docs/exc/deleteExcDTableData"})
            .addDetailTotalRow()
            .addDetailSubTotalCountNumberTextBox("ИТОГО СТРОК:", 140, {inputStyle:"width:40px;"})
            .addDetailSubtotalNumberTextBox("ИТОГО КОЛ-ВО:", 410, "Qty", {pattern:"###,###,##0.#########", inputStyle:"width:50px;"})
            .addDetailSubtotalNumberTextBox("ИТОГО ФАКТ. КОЛ-ВО:", 240, "NewQty", {pattern:"###,###,##0.#########", inputStyle:"width:50px;"})
            .addDetailSubtotalNumberTextBox("ИТОГО СУММА:", 220, "SumCC_wt", {pattern:"###,###,##0.00#######", inputStyle:"width:80px;"})
            .addDetailTotalRow(true)
            .addDetailTotalTextBox("Статус:", 300, "StateName", {style:"font-weight:bold;", inputStyle:"width:200px", print:false})
            .addDetailTotalNumberTextBox("В ДОКУМЕНТЕ КОЛ-ВО:", 250, "TQty",
                {pattern:"###,###,##0.#########", inputStyle:"width:50px;", style:"font-weight:bold;", printLabel:"ИТОГО КОЛИЧЕСТВО:"})
            .addDetailTotalNumberTextBox("В ДОКУМЕНТЕ ФАКТ. КОЛ-ВО:", 240, "TNewQty",
                {pattern:"###,###,##0.#########", inputStyle:"width:50px;", style:"font-weight:bold;", printLabel:"ИТОГО КОЛИЧЕСТВО:"})
            .addDetailTotalNumberTextBox("В ДОКУМЕНТЕ СУММА:", 220, "TSumCC_wt",
                {pattern:"###,###,##0.00#######", inputStyle:"width:80px;", style:"font-weight:bold;", printLabel:"ИТОГО СУММА:"})

            .addDetailTotalRow(true)
//            .addDetailTotalTextBox("Статус:", 753, "StateName", {style:"font-weight:bold;", inputStyle:"width:200px", print:false})

            .addToolPane({title:"Действия"})
//            .addToolPaneActionButton("Новая накладная", {btnStyle:"width:200px;", actionButtonName:"loadHeaderNewValues"})
//            .addToolPaneActionButton("Сохранить накладную", {btnStyle:"width:200px;", actionButtonName:"storeHeaderValues"})
//            .addToolPaneActionButton("Отменить изменения", {btnStyle:"width:200px;", actionButtonName:"loadHeaderLastValues"})
//            .addToolPaneActionButton("Удалить накладную", {btnStyle:"width:200px;", actionButtonName:"deleteHeader"})
            .addToolPaneBR()
//            .addToolPaneActionButton("Добавить строку", {btnStyle:"width:200px;", actionButtonName:"insertDetailTableRow"})
//            .addToolPaneActionButton("Копировать строку", {btnStyle:"width:200px;", actionButtonName:"insertDetailTableCopySelectedRow"})
            .addToolPaneActionButton("Изменить строку", {btnStyle:"width:200px;", actionButtonName:"allowEditDetailTableSelectedRow"})
            .addToolPaneActionButton("Сохранить строку", {btnStyle:"width:200px;", actionButtonName:"storeDetailTableSelectedRow"})
//            .addToolPaneActionButton("Удалить строку", {btnStyle:"width:200px;", actionButtonName:"deleteDetailTableSelectedRow"})
//                        .addToolPane({title:"Статус документа"})
//                        .addToolPaneActionButton("Установить статус \"Закрыт\"", { btnStyle:"width:200px;",
//                            actionFunction: function (params) {
//                                var pinvId =  params.thisInstance.detailHeader.data.ID;    console.log("pinvId=",pinvId);
//                                Request.postJSONData({url: "/wrh/pInvoices/closePInv", data: {"PINV_ID": pinvId}},
//                                    function(result){
//                                        params.thisInstance.setDetailHeaderContentByListSelectedRow(wrh_pinv.detailHeader.lastContentData, {reloadData:true, clearBeforeLoad:true});
//                                });
//                            }
//                        })
//                        .addToolPaneActionButton("Установить статус \"В работе\"", {btnStyle:"width:200px;"})
            .addDetailTableMenuItemAction("Добавить строки",{action:"insertDetailTableRowsAfterSelected",rowPosName:"POS"})//rowPosIndexName:"POSIND"
            .addDetailTableMenuItemAction("Изменить строки",{action:"allowEditDetailTableSelectedRows"})
            .addDetailTableMenuItemAction("Сохранить строки",{action:"storeDetailTableSelectedRows"})
//                        .addToolPane({title:"экспорт"})
//                        .addToolPaneActionButton("таблица в эксель", {btnStyle: "width:200px;",detailTableActionName:"exportTableContentToExcel"})
//            .addToolPane({title:"Печать"})
//            .addToolPaneActionButton("Печать ценников", {btnStyle: "width:200px;",detailTableActionName:"printProdTags",
//                actionFunction:  function(actionFunctionParams){                                        console.log("printProdTags.onClick actionFunctionParams=",actionFunctionParams);
//                    var printWindow= window.open("/print/printProductsTags");                           //console.log("printProdTags.onClick printWindow=",printWindow);
//                    //window.open("/print?pinvid="+docs_exc_ContentController.getDataIDValue(), "", "location=1,status=1,scrollbars=1,width=650,height=600");
//                    printWindow["prodTagsContentData"]= actionFunctionParams.detailTable.getContent();
//                    printWindow["pageProdTagType"]= "productTag40x25";}
//            })
//            .addToolPaneActionButton("Печать цен", {btnStyle: "width:200px;", detailTableActionName:"printProdPricesTags",
//                actionFunction:function(actionFunctionParams){
//                    var printWindow= window.open("/print/printProductsTags");
//                    //window.open("/print?pinvid="+docs_exc_ContentController.getDataIDValue(), "", "location=1,status=1,scrollbars=1,width=650,height=600");
//                    var detailTableContentData=actionFunctionParams.detailTable.getContent();
//                    for(var row=0;row<detailTableContentData.length;row++) detailTableContentData[row]["QTY"]=1;
//                    printWindow["prodTagsContentData"]= detailTableContentData;
//                    printWindow["pageProdTagType"]= "tag40x25price";
//                }
//            })
            .addToolPane({title:"Информация о товаре",
                detailTableAction:function(toolPane, detailHeader,detailTable,thisInstance){
                    var detailTableSelectedRow= detailTable.getSelectedRow();
                    if(!detailTableSelectedRow){
                        toolPane.set("content","");
                        return;
                    }
                    var htCols = detailTable.getColumns(); var prodInfoHtml = "";

                    for(var c=0;c<htCols.length;c++){
                        var colItem = htCols[c]; var colData = colItem["data"];
                        var colValue = detailTableSelectedRow[colData];
                        if(colData.indexOf('Prod')==0||colData=='UM'||colData.indexOf('Barcode')==0
                                ||colData.indexOf('Article')==0||colData.indexOf('PCat')==0||colData.indexOf('PGr')==0
                                ||colData.indexOf('Color')==0||colData.indexOf('Size')==0)
                            prodInfoHtml = prodInfoHtml + "<tr><td>"+"<b>"+colItem["name"]+":</b> "+((!colValue)?'':colValue)+"</td></tr>";
                    }
                    toolPane.set("content","<table style=\"margin:0;padding:0;\">"+prodInfoHtml+"</table>");
                }
            })
            .addToolXPane("Ценник товара", function(toolPane, detailHeader,detailTable,thisInstance){
//                            toolPane.set("content","");
                var detailTableSelectedRow= detailTable.getSelectedRow();
                if(detailTableSelectedRow) {
                    var prodTagContentData = {};
                    for(var rowItemName in detailTableSelectedRow) prodTagContentData[rowItemName]= detailTableSelectedRow[rowItemName];
                    toolPane.set("prodTagContentData", prodTagContentData);
                    toolPane.set("href","/print/productTag40x25");
                }
            })
            .startupDoc();
</script>
